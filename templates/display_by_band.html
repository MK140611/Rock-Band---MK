{% extends "base.html" %}
{% block content %}
<h2>Bands</h2>

{% for band in bands %}
<section>
  <h3>
    {{ band.BandName }} ({{ band.FormedYear }})
  </h3>
  <p><strong>Home:</strong> {{ band.HomeLocation }}</p>

  <h4>Members</h4>
  <ul>
    {% for m in band.memberships %}
    <li>
      {{ m.member.MemberName }} – {{ m.Role or m.member.MainPosition }}
      {% if m.StartYear %}
        ({{ m.StartYear }}{% if m.EndYear %} – {{ m.EndYear }}{% else %} – present{% endif %})
      {% endif %}
      &nbsp;
      <a href="{{ url_for('edit_membership', id=m.MembershipID) }}">Edit</a> |
      <a href="{{ url_for('delete_membership', id=m.MembershipID) }}">Delete</a>
    </li>
    {% else %}
    <li><em>No members assigned yet</em></li>
    {% endfor %}
  </ul>

  <h4>Albums</h4>
  <ul>
    {% for collab in band.collabs %}
    <li>
      <strong>{{ collab.albums.AlbumTitle }}</strong> ({{ collab.albums.ReleaseYear }})<br>
      <em>Collaborators:</em>
      {% set collaborators = [] %}
      {% for collaborator in collab.albums.bands %}
        {% if collaborator.BandID != band.BandID %}
          {% set _ = collaborators.append(collaborator.BandName) %}
        {% endif %}
      {% endfor %}
      {% if collaborators %}
        {{ collaborators | join(', ') }}
      {% else %}
        None
      {% endif %}
    </li>
    {% endfor %}
  </ul>
</section>
<hr />
{% endfor %}
{% endblock %}
